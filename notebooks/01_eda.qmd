---
title: "Exploratory Data Analysis (EDA)"
author: "Harriet O'Brien, Vy Tran, Saniyah Khan, Rehinatu Usman"
format: 
    html:
        toc: true
        number-sections: true
        theme: cosmo
---


# Introduction:
The goal of this exploratory data analysis is to understand the historical reimbursement patterns in ACME Corporation's legacy system. 

We will summarize and visualize the data to identify trends, relationships, and potential business rules that influence the reimbursement amount. 

# Basic set up

```{python}
# Basic imports for data manipulation and visualization.
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# Display settings so that tables and plots are easier to read.
pd.set_option('display.max_columns', None)
sns.set(style="whitegrid")
```
```{python}
import json

# Load JSON dataset
with open("../data/public_cases.json", "r") as f:
    data = json.load(f)

df = pd.DataFrame(data)
df.head()
```
```{python}
df.info()
df.describe()
df.isnull().sum()
```
# Normalize JSON structure
```{python}
features = pd.json_normalize(df['input'])
features['reimbursement_amount'] = df['expected_output']

features.head()
features.info()
```
# Histogram
```{python}
num_cols = ['trip_duration_days', 'miles_traveled',
            'total_receipts_amount', 'reimbursement_amount']

for col in num_cols:
    plt.figure(figsize=(6,4))
    sns.histplot(features[col], kde=True)
    plt.title(f"Distribution of {col}")
    plt.show()
```
Histogram of trip_duration_days

The distribution of trip_duration_days is right-skewed, indicating that most business trips are short (3–7 days). A smaller portion of trips extends to 10–14 days, which may represent special assignments or long-distance travel

Histogram of miles_traveled

Miles_traveled shows a wide spread with several long-distance trips. The distribution suggests two patterns: a large number of mid-range trips (300–800 miles) and several extreme long-distance cases (>1000 miles), which could indicate special travel requirements or multi-leg trips.

Histogram of total_receipts_amount

The total_receipts_amount distribution is fairly uniform with a slight right-skew, showing that most employees incur moderate expenses. Higher receipt amounts (>2000) may reflect extended trips or multiple reimbursement categories

Histogram of reimbursement_amount

Reimbursement_amount is right-skewed with a concentration between 1200–1800. Higher reimbursements are less frequent but appear consistently, suggesting they may correspond to longer trips or greater miles traveled.

# Correlation Heatmap
```{python}
plt.figure(figsize=(8,6))
sns.heatmap(features.corr(), annot=True, cmap="coolwarm", fmt=".2f")
plt.title("Correlation Heatmap")
plt.show()
```

The heatmap shows that reimbursement_amount is most strongly correlated with:

- total_receipts_amount (0.70) -> receipts drive reimbursement calculations.
- miles_traveled (0.43) -> longer distances contribute significantly.
- trip_duration_days (0.51) -> longer trips increase reimbursement but at a moderate rate.

This indicates the reimbursement formula likely depends on both mileage and receipt totals.

# Pairplot
```{python}
sns.pairplot(features[num_cols])
plt.show()
```
The pairplot reveals:
A visible positive relationship between total_receipts_amount and reimbursement_amount.
A moderate upward trend between trip_duration_days and reimbursement_amount.
High variance in miles_traveled, confirming diverse travel distances.
No strong nonlinear patterns or clusters are present, suggesting the dataset is fairly continuous.

# Boxplots (Outlier Analysis)
```{python}
for col in num_cols:
    plt.figure(figsize=(5,4))
    sns.boxplot(x=features[col])
    plt.title(f"Outliers in {col}")
    plt.show()
```
Outliers in trip_duration_days: a few trips extend to the maximum of 14 days, indicating possible special corporate assignments.
Outliers in miles_traveled: long-distance outliers (>1200 miles) are present, likely representing air travel or multi-state trips.
Outliers in total_receipts_amount: high-receipt outliers (>2000) suggest multi-category expenses or longer durations.
Outliers in reimbursement_amount: reimbursement outliers match the receipt and mileage outliers, confirming consistency in the reimbursement rules.
```{python}
df.columns
```
```{python}
plt.figure(figsize=(6,5))
sns.scatterplot(data=features, x="miles_traveled", y="reimbursement_amount")
plt.title("Mileage vs Reimbursement Amount")
plt.show()
```

# Summary of Findings

Overall, this exploratory analysis suggests that: 

- The dataset is structurally sound and free of missing values in the key fields.

- Most business trips are relatively short in duration, but miles traveled and receipts vary over a wide range.

- Reimbursement amount is driven mainly by total receipts, with miles traveled providing an additional, secondary influence. 

- Trip duration has a weaker direct relationship with reimbursement, which hints that ACME’s policy is more cost-based than time-based. 

- Outliers in distance, receipts, and reimbursement appear to reflect legitimate high-cost or long-distance trips rather than data quality problems. 

- These patterns provide a clear basis for the next step: building and evaluating predictive models that estimate reimbursement amounts from trip characteristics.

